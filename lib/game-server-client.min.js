/** * Game Server Client Library * A JavaScript library for interacting with the Game Server API */class GameServerClient { constructor(config) { if (!config || typeof config !== 'object') { throw new Error('Configuration object is required'); } if (!config.gameKey) { throw new Error('gameKey is required in configuration'); } this.baseUrl = config.baseUrl || 'https://game-server-97828933506.europe-west1.run.app'; this.gameKey = config.gameKey; this.userUuid = config.userUuid || this.generateUUID(); this.sessionUuid = null; this.language = config.language || this.detectLanguage(); this.timeout = config.timeout || 30000; // Default 30 second timeout } /** * Generate a UUID v4 */ generateUUID() { return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) { const r = Math.random() * 16 | 0; const v = c === 'x' ? r : (r & 0x3 | 0x8); return v.toString(16); }); } /** * Detect browser/device language */ detectLanguage() { if (typeof navigator !== 'undefined') { return navigator.language || navigator.userLanguage || 'en-US'; } return 'en-US'; } /** * Make HTTP request */ async request(endpoint, method = 'GET', body = null) { const options = { method, headers: { 'Content-Type': 'application/json' } }; if (body) { options.body = JSON.stringify(body); } try { // Create abort controller for timeout const controller = new AbortController(); const timeoutId = setTimeout(() => controller.abort(), this.timeout); options.signal = controller.signal; const response = await fetch(`${this.baseUrl}${endpoint}`, options); clearTimeout(timeoutId); const data = await response.json(); if (!response.ok) { throw new Error(data.error || 'Request failed'); } return data; } catch (error) { if (error.name === 'AbortError') { console.error('Game Server API Error: Request timeout'); throw new Error('Request timeout'); } console.error('Game Server API Error:', error); throw error; } } /** * Start a new game session */ async startSession(customSessionUuid = null) { this.sessionUuid = customSessionUuid || this.generateUUID(); const response = await this.request('/api/session/start', 'POST', { gameKey: this.gameKey, userUuid: this.userUuid, sessionUuid: this.sessionUuid, language: this.language, timestamp: new Date().toISOString() }); return response; } /** * End the current session */ async endSession() { if (!this.sessionUuid) { throw new Error('No active session to end'); } const response = await this.request('/api/session/end', 'POST', { sessionUuid: this.sessionUuid, timestamp: new Date().toISOString() }); this.sessionUuid = null; return response; } /** * Track an event */ async trackEvent(eventKey, data = null) { if (!this.sessionUuid) { throw new Error('No active session. Start a session first.'); } const response = await this.request('/api/event', 'POST', { sessionUuid: this.sessionUuid, eventKey, timestamp: new Date().toISOString(), data }); return response; } /** * Get A/B test configuration */ async getABTestConfig() { const response = await this.request('/api/abtest', 'POST', { gameKey: this.gameKey, userUuid: this.userUuid, sessionUuid: this.sessionUuid }); return response.assignments || {}; } /** * Helper method to track win event */ async trackWin(data = null) { return this.trackEvent('win', data); } /** * Helper method to track lose event */ async trackLose(data = null) { return this.trackEvent('lose', data); } /** * Helper method to track level complete */ async trackLevelComplete(level, data = null) { return this.trackEvent('level_complete', { level, ...data }); } /** * Get current session UUID */ getSessionUuid() { return this.sessionUuid; } /** * Get user UUID */ getUserUuid() { return this.userUuid; }}// Export for different module systemsif (typeof module !== 'undefined' && module.exports) { module.exports = GameServerClient;}if (typeof window !== 'undefined') { window.GameServerClient = GameServerClient;}
